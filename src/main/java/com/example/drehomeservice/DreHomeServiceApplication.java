package com.example.drehomeservice;

import feign.Response;
import org.apache.commons.io.Charsets;
import org.apache.commons.io.IOUtils;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.w3c.dom.Document;
import org.w3c.dom.NodeList;
import org.xml.sax.InputSource;
import org.xml.sax.SAXException;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.ParserConfigurationException;
import java.io.IOException;
import java.io.InputStream;
import java.io.StringReader;
import java.nio.charset.StandardCharsets;
import java.util.HashMap;
import java.util.Map;

@SpringBootApplication
public class DreHomeServiceApplication {

    public static void main(String[] args) {
//        SpringApplication.run(DreHomeServiceApplication.class, args);
        Map<Integer, String> test = getDevicesIdsFromResponse("[{\"dev_id\":2,\"undev\":0,\"undev_address\":3781220790308737,\"compozit_serial\":0,\"dev_name\":\"Датчик открытия-1\",\"dvtp_num\":1026,\"group_group_id\":2,\"ctgr_ctgr_id\":3,\"dvsn_dvsn_id\":17,\"dev_x\":0,\"dev_y\":0,\"dev_z\":0,\"zcluster\":[{\"zcl_id\":0,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":3,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":7,\"str_attr_value\":\"3\",\"num_attr_value\":1},{\"attr_key\":16387,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":4,\"str_attr_value\":\"GS\",\"num_attr_value\":1},{\"attr_key\":5,\"str_attr_value\":\"SOHM-I1\",\"num_attr_value\":1},{\"attr_key\":6,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":1280,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"1\",\"num_attr_value\":1},{\"attr_key\":1,\"str_attr_value\":\"21\",\"num_attr_value\":1},{\"attr_key\":2,\"str_attr_value\":\"32\",\"num_attr_value\":1},{\"attr_key\":65534,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":16,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":3,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":1,\"attributes\":[{\"attr_key\":33,\"str_attr_value\":\"185\",\"num_attr_value\":1}]},{\"zcl_id\":65527,\"attributes\":[{\"attr_key\":7,\"str_attr_value\":\"3\",\"num_attr_value\":1},{\"attr_key\":1280,\"str_attr_value\":\"21\",\"num_attr_value\":1},{\"attr_key\":65521,\"str_attr_value\":\"9729\",\"num_attr_value\":1},{\"attr_key\":65522,\"str_attr_value\":\"4619\",\"num_attr_value\":1},{\"attr_key\":4,\"str_attr_value\":\"GS\",\"num_attr_value\":1},{\"attr_key\":5,\"str_attr_value\":\"SOHM-I1\",\"num_attr_value\":1}]}]},{\"dev_id\":1,\"undev\":0,\"undev_address\":3781220809499754,\"compozit_serial\":0,\"dev_name\":\"Датчик движения-1\",\"dvtp_num\":1026,\"group_group_id\":2,\"ctgr_ctgr_id\":3,\"dvsn_dvsn_id\":11,\"dev_x\":0,\"dev_y\":0,\"dev_z\":0,\"zcluster\":[{\"zcl_id\":0,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":3,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":7,\"str_attr_value\":\"3\",\"num_attr_value\":1},{\"attr_key\":16387,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":4,\"str_attr_value\":\"GS\",\"num_attr_value\":1},{\"attr_key\":5,\"str_attr_value\":\"SMHM-I1\",\"num_attr_value\":1},{\"attr_key\":6,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":1280,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"1\",\"num_attr_value\":1},{\"attr_key\":1,\"str_attr_value\":\"13\",\"num_attr_value\":1},{\"attr_key\":2,\"str_attr_value\":\"32\",\"num_attr_value\":1},{\"attr_key\":65534,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":16,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":3,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":1,\"attributes\":[{\"attr_key\":33,\"str_attr_value\":\"200\",\"num_attr_value\":1}]},{\"zcl_id\":65526,\"attributes\":[{\"attr_key\":7,\"str_attr_value\":\"3\",\"num_attr_value\":1},{\"attr_key\":1280,\"str_attr_value\":\"13\",\"num_attr_value\":1},{\"attr_key\":65521,\"str_attr_value\":\"9732\",\"num_attr_value\":1},{\"attr_key\":65522,\"str_attr_value\":\"4619\",\"num_attr_value\":1},{\"attr_key\":4,\"str_attr_value\":\"GS\",\"num_attr_value\":1},{\"attr_key\":5,\"str_attr_value\":\"SMHM-I1\",\"num_attr_value\":1}]}]},{\"dev_id\":3,\"undev\":0,\"undev_address\":3781220813477623,\"compozit_serial\":0,\"dev_name\":\"RosetteGSLabs\",\"dvtp_num\":81,\"group_group_id\":2,\"ctgr_ctgr_id\":1,\"dvsn_dvsn_id\":18,\"dev_x\":0,\"dev_y\":0,\"dev_z\":0,\"zcluster\":[{\"zcl_id\":0,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":3,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":7,\"str_attr_value\":\"1\",\"num_attr_value\":1},{\"attr_key\":16387,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":4,\"str_attr_value\":\"GS\",\"num_attr_value\":1},{\"attr_key\":5,\"str_attr_value\":\"SKHMP30-I1\",\"num_attr_value\":1},{\"attr_key\":6,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":6,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"1\",\"num_attr_value\":1}]},{\"zcl_id\":9,\"attributes\":[]},{\"zcl_id\":4,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":3,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":1794,\"attributes\":[{\"attr_key\":771,\"str_attr_value\":\"172\",\"num_attr_value\":1},{\"attr_key\":0,\"str_attr_value\":\"99\",\"num_attr_value\":1}]},{\"zcl_id\":65531,\"attribute\n" +
                "        s\":[{\"attr_key\":7,\"str_attr_value\":\"1\",\"num_attr_value\":1},{\"attr_key\":771,\"str_attr_value\":\"172\",\"num_attr_value\":1},{\"attr_key\":65521,\"str_attr_value\":\"9739\",\"num_attr_value\":1},{\"attr_key\":65522,\"str_attr_value\":\"4619\",\"num_attr_value\":1},{\"attr_key\":4,\"str_attr_value\":\"GS\",\"num_attr_value\":1},{\"attr_key\":5,\"str_attr_value\":\"SKHMP30-I1\",\"num_attr_value\":1}]},{\"zcl_id\":2820,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"0\",\"num_attr_value\":1}]}]},{\"dev_id\":5,\"undev\":0,\"undev_address\":6066005681705575,\"compozit_serial\":0,\"dev_name\":\"Лампа-2\",\"dvtp_num\":268,\"group_group_id\":2,\"ctgr_ctgr_id\":2,\"dvsn_dvsn_id\":1,\"dev_x\":0,\"dev_y\":0,\"dev_z\":0,\"zcluster\":[{\"zcl_id\":0,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":3,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":7,\"str_attr_value\":\"1\",\"num_attr_value\":1},{\"attr_key\":16387,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":4,\"str_attr_value\":\"GS\",\"num_attr_value\":1},{\"attr_key\":5,\"str_attr_value\":\"BDHM8E27W70-I1\",\"num_attr_value\":1},{\"attr_key\":6,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":6,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"0\",\"num_attr_value\":1}]},{\"zcl_id\":4,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":3,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":768,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":1,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":8,\"str_attr_value\":\"2\",\"num_attr_value\":1},{\"attr_key\":3,\"str_attr_value\":\"20743\",\"num_attr_value\":1},{\"attr_key\":4,\"str_attr_value\":\"21489\",\"num_attr_value\":1},{\"attr_key\":7,\"str_attr_value\":\"155\",\"num_attr_value\":1},{\"attr_key\":16395,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":16396,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":8,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"254\",\"num_attr_value\":1},{\"attr_key\":17,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":1,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":16,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":65534,\"attributes\":[{\"attr_key\":7,\"str_attr_value\":\"1\",\"num_attr_value\":1},{\"attr_key\":65025,\"str_attr_value\":\"8\",\"num_attr_value\":1},{\"attr_key\":65521,\"str_attr_value\":\"1565\",\"num_attr_value\":1},{\"attr_key\":65522,\"str_attr_value\":\"4619\",\"num_attr_value\":1},{\"attr_key\":4,\"str_attr_value\":\"GS\",\"num_attr_value\":1},{\"attr_key\":5,\"str_attr_value\":\"BDHM8E27W70-I1\",\"num_attr_value\":1}]}]},{\"dev_id\":4,\"undev\":0,\"undev_address\":6066005693579808,\"compozit_serial\":0,\"dev_name\":\"Лампа-1\",\"dvtp_num\":268,\"group_group_id\":2,\"ctgr_ctgr_id\":2,\"dvsn_dvsn_id\":1,\"dev_x\":0,\"dev_y\":0,\"dev_z\":0,\"zcluster\":[{\"zcl_id\":0,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":3,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":7,\"str_attr_value\":\"1\",\"num_attr_value\":1},{\"attr_key\":16387,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":4,\"str_attr_value\":\"GS\",\"num_attr_value\":1},{\"attr_key\":5,\"str_attr_value\":\"BDHM8E27W70-I1\",\"num_attr_value\":1},{\"attr_key\":6,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":6,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"0\",\"num_attr_value\":1}]},{\"zcl_id\":4,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":3,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":768,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":1,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":8,\"str_attr_value\":\"2\",\"num_attr_value\":1},{\"attr_key\":3,\"str_attr_value\":\"30254\",\"num_attr_value\":1},{\"attr_key\":4,\"str_attr_value\":\"27182\",\"num_attr_value\":1},{\"attr_key\":7,\"str_attr_value\":\"369\",\"num_attr_value\":1},{\"attr_key\":16395,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":16396,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":8,\"attributes\":[{\"attr_key\":0,\"str_attr_value\":\"1\",\"num_attr_value\":1},{\"attr_key\":17,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":1,\"str_attr_value\":\"\",\"num_attr_value\":0},{\"attr_key\":16,\"str_attr_value\":\"\",\"num_attr_value\":0}]},{\"zcl_id\":65534,\"attribu\n" +
                "        tes\":[{\"attr_key\":7,\"str_attr_value\":\"1\",\"num_attr_value\":1},{\"attr_key\":65025,\"str_attr_value\":\"8\",\"num_attr_value\":1},{\"attr_key\":65521,\"str_attr_value\":\"1565\",\"num_attr_value\":1},{\"attr_key\":65522,\"str_attr_value\":\"4619\",\"num_attr_value\":1},{\"attr_key\":4,\"str_attr_value\":\"GS\",\"num_attr_value\":1},{\"attr_key\":5,\"str_attr_value\":\"BDHM8E27W70-I1\",\"num_attr_value\":1}]}]}]");
    }

/*[{"dev_id":2,"undev":0,"undev_address":3781220790308737,"compozit_serial":0,"dev_name":"Датчик открытия-1","dvtp_num":1026,"group_group_id":2,"ctgr_ctgr_id":3,"dvsn_dvsn_id":17,"dev_x":0,"dev_y":0,"dev_z":0,"zcluster":[{"zcl_id":0,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0},{"attr_key":3,"str_attr_value":"","num_attr_value":0},{"attr_key":7,"str_attr_value":"3","num_attr_value":1},{"attr_key":16387,"str_attr_value":"","num_attr_value":0},{"attr_key":4,"str_attr_value":"GS","num_attr_value":1},{"attr_key":5,"str_attr_value":"SOHM-I1","num_attr_value":1},{"attr_key":6,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":1280,"attributes":[{"attr_key":0,"str_attr_value":"1","num_attr_value":1},{"attr_key":1,"str_attr_value":"21","num_attr_value":1},{"attr_key":2,"str_attr_value":"32","num_attr_value":1},{"attr_key":65534,"str_attr_value":"","num_attr_value":0},{"attr_key":16,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":3,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":1,"attributes":[{"attr_key":33,"str_attr_value":"185","num_attr_value":1}]},{"zcl_id":65527,"attributes":[{"attr_key":7,"str_attr_value":"3","num_attr_value":1},{"attr_key":1280,"str_attr_value":"21","num_attr_value":1},{"attr_key":65521,"str_attr_value":"9729","num_attr_value":1},{"attr_key":65522,"str_attr_value":"4619","num_attr_value":1},{"attr_key":4,"str_attr_value":"GS","num_attr_value":1},{"attr_key":5,"str_attr_value":"SOHM-I1","num_attr_value":1}]}]},{"dev_id":1,"undev":0,"undev_address":3781220809499754,"compozit_serial":0,"dev_name":"Датчик движения-1","dvtp_num":1026,"group_group_id":2,"ctgr_ctgr_id":3,"dvsn_dvsn_id":11,"dev_x":0,"dev_y":0,"dev_z":0,"zcluster":[{"zcl_id":0,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0},{"attr_key":3,"str_attr_value":"","num_attr_value":0},{"attr_key":7,"str_attr_value":"3","num_attr_value":1},{"attr_key":16387,"str_attr_value":"","num_attr_value":0},{"attr_key":4,"str_attr_value":"GS","num_attr_value":1},{"attr_key":5,"str_attr_value":"SMHM-I1","num_attr_value":1},{"attr_key":6,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":1280,"attributes":[{"attr_key":0,"str_attr_value":"1","num_attr_value":1},{"attr_key":1,"str_attr_value":"13","num_attr_value":1},{"attr_key":2,"str_attr_value":"32","num_attr_value":1},{"attr_key":65534,"str_attr_value":"","num_attr_value":0},{"attr_key":16,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":3,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":1,"attributes":[{"attr_key":33,"str_attr_value":"200","num_attr_value":1}]},{"zcl_id":65526,"attributes":[{"attr_key":7,"str_attr_value":"3","num_attr_value":1},{"attr_key":1280,"str_attr_value":"13","num_attr_value":1},{"attr_key":65521,"str_attr_value":"9732","num_attr_value":1},{"attr_key":65522,"str_attr_value":"4619","num_attr_value":1},{"attr_key":4,"str_attr_value":"GS","num_attr_value":1},{"attr_key":5,"str_attr_value":"SMHM-I1","num_attr_value":1}]}]},{"dev_id":3,"undev":0,"undev_address":3781220813477623,"compozit_serial":0,"dev_name":"RosetteGSLabs","dvtp_num":81,"group_group_id":2,"ctgr_ctgr_id":1,"dvsn_dvsn_id":18,"dev_x":0,"dev_y":0,"dev_z":0,"zcluster":[{"zcl_id":0,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0},{"attr_key":3,"str_attr_value":"","num_attr_value":0},{"attr_key":7,"str_attr_value":"1","num_attr_value":1},{"attr_key":16387,"str_attr_value":"","num_attr_value":0},{"attr_key":4,"str_attr_value":"GS","num_attr_value":1},{"attr_key":5,"str_attr_value":"SKHMP30-I1","num_attr_value":1},{"attr_key":6,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":6,"attributes":[{"attr_key":0,"str_attr_value":"1","num_attr_value":1}]},{"zcl_id":9,"attributes":[]},{"zcl_id":4,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":3,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":1794,"attributes":[{"attr_key":771,"str_attr_value":"172","num_attr_value":1},{"attr_key":0,"str_attr_value":"99","num_attr_value":1}]},{"zcl_id":65531,"attribute
        s":[{"attr_key":7,"str_attr_value":"1","num_attr_value":1},{"attr_key":771,"str_attr_value":"172","num_attr_value":1},{"attr_key":65521,"str_attr_value":"9739","num_attr_value":1},{"attr_key":65522,"str_attr_value":"4619","num_attr_value":1},{"attr_key":4,"str_attr_value":"GS","num_attr_value":1},{"attr_key":5,"str_attr_value":"SKHMP30-I1","num_attr_value":1}]},{"zcl_id":2820,"attributes":[{"attr_key":0,"str_attr_value":"0","num_attr_value":1}]}]},{"dev_id":5,"undev":0,"undev_address":6066005681705575,"compozit_serial":0,"dev_name":"Лампа-2","dvtp_num":268,"group_group_id":2,"ctgr_ctgr_id":2,"dvsn_dvsn_id":1,"dev_x":0,"dev_y":0,"dev_z":0,"zcluster":[{"zcl_id":0,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0},{"attr_key":3,"str_attr_value":"","num_attr_value":0},{"attr_key":7,"str_attr_value":"1","num_attr_value":1},{"attr_key":16387,"str_attr_value":"","num_attr_value":0},{"attr_key":4,"str_attr_value":"GS","num_attr_value":1},{"attr_key":5,"str_attr_value":"BDHM8E27W70-I1","num_attr_value":1},{"attr_key":6,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":6,"attributes":[{"attr_key":0,"str_attr_value":"0","num_attr_value":1}]},{"zcl_id":4,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":3,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":768,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0},{"attr_key":1,"str_attr_value":"","num_attr_value":0},{"attr_key":8,"str_attr_value":"2","num_attr_value":1},{"attr_key":3,"str_attr_value":"20743","num_attr_value":1},{"attr_key":4,"str_attr_value":"21489","num_attr_value":1},{"attr_key":7,"str_attr_value":"155","num_attr_value":1},{"attr_key":16395,"str_attr_value":"","num_attr_value":0},{"attr_key":16396,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":8,"attributes":[{"attr_key":0,"str_attr_value":"254","num_attr_value":1},{"attr_key":17,"str_attr_value":"","num_attr_value":0},{"attr_key":1,"str_attr_value":"","num_attr_value":0},{"attr_key":16,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":65534,"attributes":[{"attr_key":7,"str_attr_value":"1","num_attr_value":1},{"attr_key":65025,"str_attr_value":"8","num_attr_value":1},{"attr_key":65521,"str_attr_value":"1565","num_attr_value":1},{"attr_key":65522,"str_attr_value":"4619","num_attr_value":1},{"attr_key":4,"str_attr_value":"GS","num_attr_value":1},{"attr_key":5,"str_attr_value":"BDHM8E27W70-I1","num_attr_value":1}]}]},{"dev_id":4,"undev":0,"undev_address":6066005693579808,"compozit_serial":0,"dev_name":"Лампа-1","dvtp_num":268,"group_group_id":2,"ctgr_ctgr_id":2,"dvsn_dvsn_id":1,"dev_x":0,"dev_y":0,"dev_z":0,"zcluster":[{"zcl_id":0,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0},{"attr_key":3,"str_attr_value":"","num_attr_value":0},{"attr_key":7,"str_attr_value":"1","num_attr_value":1},{"attr_key":16387,"str_attr_value":"","num_attr_value":0},{"attr_key":4,"str_attr_value":"GS","num_attr_value":1},{"attr_key":5,"str_attr_value":"BDHM8E27W70-I1","num_attr_value":1},{"attr_key":6,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":6,"attributes":[{"attr_key":0,"str_attr_value":"0","num_attr_value":1}]},{"zcl_id":4,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":3,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":768,"attributes":[{"attr_key":0,"str_attr_value":"","num_attr_value":0},{"attr_key":1,"str_attr_value":"","num_attr_value":0},{"attr_key":8,"str_attr_value":"2","num_attr_value":1},{"attr_key":3,"str_attr_value":"30254","num_attr_value":1},{"attr_key":4,"str_attr_value":"27182","num_attr_value":1},{"attr_key":7,"str_attr_value":"369","num_attr_value":1},{"attr_key":16395,"str_attr_value":"","num_attr_value":0},{"attr_key":16396,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":8,"attributes":[{"attr_key":0,"str_attr_value":"1","num_attr_value":1},{"attr_key":17,"str_attr_value":"","num_attr_value":0},{"attr_key":1,"str_attr_value":"","num_attr_value":0},{"attr_key":16,"str_attr_value":"","num_attr_value":0}]},{"zcl_id":65534,"attribu
        tes":[{"attr_key":7,"str_attr_value":"1","num_attr_value":1},{"attr_key":65025,"str_attr_value":"8","num_attr_value":1},{"attr_key":65521,"str_attr_value":"1565","num_attr_value":1},{"attr_key":65522,"str_attr_value":"4619","num_attr_value":1},{"attr_key":4,"str_attr_value":"GS","num_attr_value":1},{"attr_key":5,"str_attr_value":"BDHM8E27W70-I1","num_attr_value":1}]}]}]*/

    private static Map<Integer, String> getDevicesIdsFromResponse(String responseDetails) {
        Map<Integer, String> connectedDevices = new HashMap<>();
        DocumentBuilderFactory factory = createDocumentBuilderFactory();
        DocumentBuilder builder = null;
        try {
            builder = factory.newDocumentBuilder();
        } catch (ParserConfigurationException e) {
            throw new RuntimeException(e);
        }
        try (StringReader stringReader = new StringReader(responseDetails)) {
            Document doc = builder.parse(new InputSource(stringReader));
            doc.getDocumentElement().normalize();
            NodeList devIds = doc.getElementsByTagName("dev_id");
            NodeList devNames = doc.getElementsByTagName("dev_name");
            for (int i = 0; i < devIds.getLength(); i++) {
                connectedDevices.put(Integer.valueOf(devIds.item(i).getTextContent()), devNames.item(i).getTextContent());
            }
        } catch (SAXException | IOException e) {
            throw new RuntimeException(e);
        }
        return connectedDevices;
    }

    private static DocumentBuilderFactory createDocumentBuilderFactory() {
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        factory.setValidating(false);
        factory.setNamespaceAware(true);
        try {
            factory.setFeature("http://xml.org/sax/features/namespaces", false);
            factory.setFeature("http://xml.org/sax/features/validation", false);
            factory.setFeature("http://apache.org/xml/features/nonvalidating/load-dtd-grammar", false);
            factory.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);
        } catch (ParserConfigurationException ignore) {
        }
        return factory;
    }

}
